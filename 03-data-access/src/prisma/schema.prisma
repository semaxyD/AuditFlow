
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  rol       String
  // Relaciones
  evaluacionesHechas Evaluacion[]    @relation("Evaluador")
  versionesCreadas   EvaluacionVersion[] @relation("Editor")
}


model Empresa {
  id          Int        @id @default(autoincrement())
  nombre      String
  direccion   String
  // Relaciones
  evaluaciones Evaluacion[]
}


model Evaluacion {
  id            Int           @id @default(autoincrement())
  empresa_id    Int
  auditor_id    Int          // Quien realiza la evaluación
  norma_id      Int
  fecha_creacion DateTime
  // Relaciones
  empresa       Empresa      @relation(fields: [empresa_id], references: [id])
  auditor       User         @relation("Evaluador", fields: [auditor_id], references: [id])
  evaluacionVersion EvaluacionVersion[]
}


model EvaluacionVersion {
  id             Int           @id @default(autoincrement())
  evaluacion_id  Int
  version_numero Int
  fecha_creacion DateTime
  usuario_id     Int
  es_actual      Boolean       @default(false)   // Para indicar si es la última versión
  // Relaciones
  evaluacion     Evaluacion   @relation(fields: [evaluacion_id], references: [id])
  editor         User         @relation("Editor", fields: [usuario_id], references: [id])
  respuestas     Respuesta[]
}


model Respuesta {
  id               Int           @id @default(autoincrement())
  evaluacion_version_id Int
  pregunta_id      Int
  puntaje          Int
  // Relaciones
  evaluacionVersion EvaluacionVersion @relation(fields: [evaluacion_version_id], references: [id])
  pregunta         Pregunta        @relation(fields: [pregunta_id], references: [id])
  evidencias       Evidencia[]
}


model Evidencia {
  id          Int      @id @default(autoincrement())
  respuesta_id Int
  url         String
  descripcion String
  // Relaciones
  respuesta   Respuesta @relation(fields: [respuesta_id], references: [id])
}


model Pregunta {
  id          Int      @id @default(autoincrement())
  criterio_id Int
  texto       String
  // Relaciones
  criterio    Criterio @relation(fields: [criterio_id], references: [id])
  respuestas  Respuesta[]
}


model Criterio {
  id           Int      @id @default(autoincrement())
  norma_id     Int
  descripcion  String
  puntaje_maximo Int
  // Relaciones
  norma        Norma   @relation(fields: [norma_id], references: [id])
  preguntas    Pregunta[]
}


model Norma {
  id          Int      @id @default(autoincrement())
  nombre      string
  descripcion String
  // Relaciones
  criterios   Criterio[]
}


